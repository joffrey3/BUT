1/CREATE TABLE DBATIMEREF_CODE (CODE VARCHAR2(10) PRIMARY KEY, CODENAME VARCHAR2(100));

CREATE TABLE DBATIMEREF_DELTATIME_LOAD (ID NUMBER, CODE VARCHAR2(10) REFERENCES DBATIMEREF_CODE(CODE), BEGINDATE DATE, ENDDATE DATE, PRIMARY KEY (ID,CODE));

INSERT INTO DBATIMEREF_CODE VALUES('B', 'BEGIN');
INSERT INTO DBATIMEREF_CODE VALUES('E', 'END');
INSERT INTO DBATIMEREF_CODE VALUES('S', 'SELECT');
INSERT INTO DBATIMEREF_CODE VALUES('I', 'INSERT');
INSERT INTO DBATIMEREF_CODE VALUES('D', 'DELETE');
INSERT INTO DBATIMEREF_CODE VALUES('U', 'UPDATE');

COMMIT;

2/A mettre dans le fichier controle :

"LOAD DATA INFILE '../APRODPerfDataIUT.txt' REPLACE INTO TABLE DBATIMEREF_DELTATIME_LOAD FIELDS TERMINATED BY '|' (ID,CODE,BEGINDATE DATE "YYYYMMDD HH24:MI:SS",ENDDATE DATE "YYYYMMDD HH24:MI:SS")


sqlldr fouche/FOUCHEJoj0103@orcliut control=control.ctl

USERID=fouche/FOUCHEJojo0103@orcliut
CONTROL='control.ctl'
LOG='error.log'


3/Requetes SQL :

3.1/
SELECT to_char(BEGINDATE,'YYYY/MM/DD HH24:MI:SS') FROM DBATIMEREF_DELTATIME_LOAD WHERE ID=40 AND CODE='B';

2020/03/27 18:00:01

3.2/
SELECT to_char(ENDDATE,'YYYY/MM/DD HH24:MI:SS') FROM DBATIMEREF_DELTATIME_LOAD WHERE ID=40 AND CODE='E';

2020/03/27 18:01:48

3.3/
SELECT (ENDDATE-BEGINDATE)/365,(ENDDATE-BEGINDATE)/30,ENDDATE-BEGINDATE, (ENDDATE-BEGINDATE)*24, (ENDDATE-BEGINDATE)*1440, (ENDDATE-BEGINDATE)*86400 FROM (SELECT ENDDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE ID=40 AND CODE='E'),(SELECT BEGINDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE ID=40 AND CODE='B'); 

	     3.3929E-06 	    .000041281	      .001238426
	    .029722222		     1.78333333 		      107

3.4/

SELECT END.ID,to_char(BEGINDATE,'YYYY-MM-DD HH24:MI:SS'),to_char(ENDDATE,'YYYY-MM-DD HH24:MI:SS'),ENDDATE-BEGINDATE FROM (SELECT ID,ENDDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(ENDDATE,'YYYY MM DD')='2020 05 15' AND CODE='E') END,(SELECT ID,BEGINDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(BEGINDATE,'YYYY MM DD')='2020 05 15' AND CODE='B') BEGIN WHERE END.ID=BEGIN.ID;

       233 2020-05-15 08:00:00 2020-05-15 08:01:34	  .001087963
       234 2020-05-15 10:00:00 2020-05-15 10:01:35	  .001099537
       235 2020-05-15 16:00:01 2020-05-15 16:01:35	  .001087963
       236 2020-05-15 18:00:00 2020-05-15 18:01:34	  .001087963

SELECT AVG(ENDDATE-BEGINDATE) FROM (SELECT ID,ENDDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(ENDDATE,'YYYY MM DD')='2020 05 15' AND CODE='E') END,(SELECT ID,BEGINDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(BEGINDATE,'YYYY MM DD')='2020 05 15' AND CODE='B') BEGIN WHERE END.ID=BEGIN.ID;

	    .001090856

3.5/
SELECT AVG(ENDDATE-BEGINDATE) FROM (SELECT ID,ENDDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(ENDDATE,'YYYY MM')='2020 05' AND CODE='E') END,(SELECT ID,BEGINDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(BEGINDATE,'YYYY MM')='2020 05' AND CODE='B') BEGIN WHERE END.ID=BEGIN.ID;


	    .001114845

3.6/
SELECT AVG(ENDDATE-BEGINDATE) FROM (SELECT ID,ENDDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(ENDDATE,'YYYY MM') BETWEEN '2020 03' AND '2021 01' AND CODE='E') END,(SELECT ID,BEGINDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(BEGINDATE,'YYYY MM') BETWEEN '2020 03' AND '2021 01' AND CODE='B') BEGIN WHERE END.ID=BEGIN.ID;

	      .0011376

3.7/
SELECT to_char(BEGINDATE,'YYYY MM'),AVG(ENDDATE-BEGINDATE) FROM (SELECT ID,ENDDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(ENDDATE,'YYYY MM') BETWEEN '2020 03' AND '2021 01' AND CODE='E') END,(SELECT ID,BEGINDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(BEGINDATE,'YYYY MM') BETWEEN '2020 03' AND '2021 01' AND CODE='B') BEGIN WHERE END.ID=BEGIN.ID GROUP BY to_char(BEGINDATE,'YYYY MM') ORDER BY to_char(BEGINDATE,'YYYY MM');

2020 03 	    .001201775
2020 04 	     .00117718
2020 05 	    .001114845
2020 06 	    .001083816
2020 07 	     .00108787
2020 08 	    .001096924
2020 09 	    .001208237
2020 10 	      .0011491
2020 11 	    .001154773
2020 12 	    .001142286
2021 01 	    .001138086

On observe une amélioration de la performance jusqu'au 08 puis une degradation du 08 au 09 et enfin une autre amélioration.

3.8/
SELECT to_char(BEGINDATE,'YYYY-MM-DD HH:MI:SS'),ENDDATE-BEGINDATE FROM (SELECT ID,ENDDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(ENDDATE,'YYYY MM') BETWEEN '2020 03' AND '2021 01' AND CODE='E') END,(SELECT ID,BEGINDATE FROM DBATIMEREF_DELTATIME_LOAD WHERE to_char(BEGINDATE,'YYYY MM') BETWEEN '2020 03' AND '2021 01' AND CODE='B') BEGIN WHERE END.ID=BEGIN.ID AND ENDDATE-BEGINDATE>=0.0015;

2020-09-07 10:00:02	    .00181713
2020-09-19 08:00:01	   .002094907
2020-09-19 10:00:00	   .001967593
2020-09-19 04:00:05	   .010196759
2020-09-19 06:00:00	   .001805556
2020-10-05 04:00:01	   .001655093
2020-10-05 06:00:01	   .002152778
2020-10-09 06:00:01	    .00150463
2020-10-26 04:00:01	   .001539352
2021-01-22 10:00:01	     .0015625
2021-01-25 04:00:02	   .001527778
